var B=Object.defineProperty,G=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var b=(o,e,t)=>e in o?B(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,h=(o,e)=>{for(var t in e||(e={}))A.call(e,t)&&b(o,t,e[t]);if(T)for(var t of T(e))V.call(e,t)&&b(o,t,e[t]);return o},y=(o,e)=>G(o,M(e));import{a as x,c as P,u as K,d as C,b as w,r as g,w as O,o as $,e as _,f as m,g as I,h as U,T as q,i as u,j as L,F,k as j,t as p,l as R,m as W,n as Y}from"./vendor.736284f9.js";const z=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))c(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function c(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}};z();const H={},J={},Q={lave:{},food:{}};var D;(function(o){o.setConfig="setConfig"})(D||(D={}));const X={[D.setConfig]:async({state:o},e)=>{var t,c,s,a,r,d;if(e=Object.fromEntries(Object.entries(e).map(([i,n])=>[i,Object.fromEntries(Object.entries(n).map(([f,l])=>[f,l===null?void 0:l]))])),((t=e.food)==null?void 0:t.schoolName)!==((c=o.food)==null?void 0:c.schoolName)&&((s=e.food)==null?void 0:s.schoolName)||((a=e.food)==null?void 0:a.schoolId)!==((r=o.food)==null?void 0:r.schoolId)&&((d=e.food)==null?void 0:d.schoolId)){const{data:i}=await x({url:`https://fatraceschool.k12ea.gov.tw/school?SchoolName=${e.food.schoolName}`,method:"GET"});let{data:n}=i;e||(e={food:{},lave:{}}),console.log(n),n.length&&(e.$_updata=!0,e.food.schoolId=n[0].SchoolId.toString(),e.food.schoolName=n[0].SchoolName)}e.$_updata!==!1&&chrome.storage&&chrome.storage.local.set({config:e}),o.food=h(h({},o.food),e.food),o.lave=h(h({},o.lave),e.lave)}},Z={namespaced:!0,mutations:J,getters:H,state:Q,actions:X};var N;(function(o){o.CONFIG="config"})(N||(N={}));const ee=P({modules:{[N.CONFIG]:Z}}),E=Symbol("vue-store"),S=()=>K(E);const te={key:0},oe={key:0,class:"menu"},se={class:"cover"},ne=["src"],ae={class:"info flex flex-down flex-item-center"},ce=["textContent"],le=["textContent"],re=C({setup(o){const e=S(),t=w(()=>e.state.config.food.schoolId),c=g();O(t,()=>s()),$(()=>clearInterval(a));const s=async()=>{var f;let d=new Date;const{data:i}=await x({url:`https://fatraceschool.k12ea.gov.tw/offered/meal?SchoolId=${t.value}&period=${[d.getFullYear(),d.getMonth()+1,d.getDate()].join("-")}&KitchenId=all`,method:"GET"});let n=(f=i==null?void 0:i.data)==null?void 0:f[0];if(n){const{data:l}=await x({url:`https://fatraceschool.k12ea.gov.tw/dish?BatchDataId=${n.BatchDataId}`,method:"GET"});c.value=l==null?void 0:l.data}},a=setInterval(s,1e3*60*10);s();const r=g();return(d,i)=>c.value?(_(),m("div",te,[I(q,null,{default:U(()=>[r.value?(_(),m("div",oe,[(_(!0),m(F,null,j(c.value,(n,f)=>(_(),m("div",{class:"dish",key:f},[u("div",se,[u("img",{src:`https://fatraceschool.k12ea.gov.tw/dish/pic/${n.DishId}`,alt:"\u83DC\u8272\u5716\u7247"},null,8,ne)]),u("div",ae,[u("span",{textContent:p(n.DishType)},null,8,ce),u("span",{textContent:p(n.DishName)},null,8,le)])]))),128))])):L("",!0)]),_:1}),u("button",{onClick:i[0]||(i[0]=n=>r.value=!r.value)},"test")])):L("",!0)}});var ie=(o,e)=>{const t=o.__vccOpts||o;for(const[c,s]of e)t[c]=s;return t};const ue={class:"lave flex flex-item-center flex-center flex-down"},de=["textContent"],fe={class:"flex"},he=["textContent"],_e=["textContent"],me=C({setup(o){const e=S(),t=w(()=>e.state.config.lave.laveTime);O(t,n=>n&&(s.value=n));const c=w(()=>e.state.config.lave.title||"\u6703\u8003\u5269\u9918"),s=g("2022-05-21T00:00:00+08:00"),a=g(),r=["\u5929","\u5C0F\u6642","\u5206\u9418","\u79D2"],d=()=>{let n=new Date(s.value).getTime()-new Date().getTime();a.value=[n/(1e3*60*60*24),n%(1e3*60*60*24)/(1e3*60*60),n%(1e3*60*60)/(1e3*60),n%(1e3*60)/1e3].map(l=>(~~l).toString().padStart(2,"0"));let f=a.value.map((l,v)=>[v,+l]).filter(([,l])=>l!==0)[0];document.title=`${c.value} ${f[1]||""}${r[f[0]]}`};d();const i=setInterval(d,100);return $(()=>clearInterval(i)),(n,f)=>(_(),m("div",ue,[u("div",{class:"title",textContent:p(R(c))},null,8,de),u("div",fe,[(_(),m(F,null,j(r,(l,v)=>{var k;return u("div",{class:"flex",key:v},[u("span",{class:"time",textContent:p((k=a.value)==null?void 0:k[v])},null,8,he),u("span",{textContent:p(l)},null,8,_e)])}),64))])]))}});var pe=ie(me,[["__scopeId","data-v-caab62ca"]]);const ve={class:"wrapper"},ge=C({setup(o){const e=S();return W(()=>{if(chrome.storage&&location.href.startsWith("chrome"))chrome.storage.onChanged.addListener(async({config:t})=>{t&&await e.dispatch("config/setConfig",y(h({},t.newValue),{$_updata:!1}))}),chrome.storage.local.get("config",({config:t})=>{t&&e.dispatch("config/setConfig",y(h({},t),{$_updata:!1}))});else{let t=new URL(location.href).searchParams;e.dispatch("config/setConfig",{lave:{title:t.get("endTitle"),laveTime:t.get("endTime")},food:{schoolId:t.get("foodSchoolId"),schoolName:t.get("foodSchoolName")},$_updata:!1})}}),$(()=>{}),(t,c)=>(_(),m("div",ve,[I(pe),I(re)]))}});Y(ge).use(ee,E).mount("#app");
