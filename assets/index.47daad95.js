var F=Object.defineProperty,j=Object.defineProperties;var E=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var S=(o,e,t)=>e in o?F(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,u=(o,e)=>{for(var t in e||(e={}))B.call(e,t)&&S(o,t,e[t]);if(D)for(var t of D(e))G.call(e,t)&&S(o,t,e[t]);return o},v=(o,e)=>j(o,E(e));import{a as g,c as A,u as M,d as y,b as x,r as k,w as P,o as C,e as h,f as _,F as O,g as T,h as V,i,t as m,j as K,k as L,l as U}from"./vendor.04df6a18.js";const q=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}};q();const R={},Y={},z={lave:{},food:{}};var I;(function(o){o.setConfig="setConfig"})(I||(I={}));const H={[I.setConfig]:async({state:o},e)=>{if(e=Object.fromEntries(Object.entries(e).map(([t,n])=>[t,Object.fromEntries(Object.entries(n).map(([s,a])=>[s,a===null?void 0:a]))])),e.food.schoolName!==o.food.schoolName&&e.food.schoolName||e.food.schoolId!==o.food.schoolId&&e.food.schoolId){const{data:t}=await g({url:`https://fatraceschool.k12ea.gov.tw/school?SchoolName=${e.food.schoolName}`,method:"GET"});let{data:n}=t;n.length&&(e.$_updata=!0,e.food.schoolId=n[0].SchoolId.toString(),e.food.schoolName=n[0].SchoolName)}e.$_updata!==!1&&chrome.storage&&chrome.storage.sync.set({config:e}),o.food=u(u({},o.food),e.food),o.lave=u(u({},o.lave),e.lave)}},J={namespaced:!0,mutations:Y,getters:R,state:z,actions:H};var $;(function(o){o.CONFIG="config"})($||($={}));const Q=A({modules:{[$.CONFIG]:J}}),b=Symbol("vue-store"),w=()=>M(b);const W={key:0,class:"menu"},X={class:"cover"},Z=["src"],ee={class:"info flex flex-down flex-item-center"},te=["textContent"],oe=["textContent"],se=y({setup(o){const e=w(),t=x(()=>e.state.config.food.schoolId),n=k();P(t,()=>s()),C(()=>clearInterval(a));const s=async()=>{var d;let l=new Date;const{data:f}=await g({url:`https://fatraceschool.k12ea.gov.tw/offered/meal?SchoolId=${t.value}&period=${[l.getFullYear(),l.getMonth()+1,l.getDate()].join("-")}&KitchenId=all`,method:"GET"});let c=(d=f==null?void 0:f.data)==null?void 0:d[0];if(c){const{data:r}=await g({url:`https://fatraceschool.k12ea.gov.tw/dish?BatchDataId=${c.BatchDataId}`,method:"GET"});n.value=r==null?void 0:r.data}},a=setInterval(s,1e3*60*10);return s(),(l,f)=>n.value?(h(),_("div",W,[(h(!0),_(O,null,T(n.value,(c,d)=>(h(),_("div",{class:"dish",key:d},[i("div",X,[i("img",{src:`https://fatraceschool.k12ea.gov.tw/dish/pic/${c.DishId}`,alt:"\u83DC\u8272\u5716\u7247"},null,8,Z)]),i("div",ee,[i("span",{textContent:m(c.DishType)},null,8,te),i("span",{textContent:m(c.DishName)},null,8,oe)])]))),128))])):V("",!0)}});var ne=(o,e)=>{const t=o.__vccOpts||o;for(const[n,s]of e)t[n]=s;return t};const ae={class:"lave flex flex-item-center flex-center flex-down"},ce=["textContent"],le={class:"flex"},re=["textContent"],ie=["textContent"],de=y({setup(o){const e=w(),t=x(()=>e.state.config.lave.laveTime||0),n=x(()=>e.state.config.lave.title||"\u6703\u8003\u5269\u9918\u5012\u6578"),s=k(),a=["\u5929","\u5C0F\u6642","\u5206\u9418","\u79D2"],l=()=>{let c=new Date(+t.value||"2022-05-21T00:00:00+08:00").getTime()-new Date().getTime();s.value=[c/(1e3*60*60*24),c%(1e3*60*60*24)/(1e3*60*60),c%(1e3*60*60)/(1e3*60),c%(1e3*60)/1e3].map(r=>(~~r).toString().padStart(2,"0"));let d=s.value.map((r,p)=>[p,+r]).filter(([,r])=>r!==0)[0];document.title=`${n.value} ${d[1]||""}${a[d[0]]}`};l();const f=setInterval(l,100);return C(()=>clearInterval(f)),(c,d)=>(h(),_("div",ae,[i("div",{class:"title",textContent:m(K(n))},null,8,ce),i("div",le,[(h(),_(O,null,T(a,(r,p)=>{var N;return i("div",{class:"flex",key:p},[i("span",{class:"time",textContent:m((N=s.value)==null?void 0:N[p])},null,8,re),i("span",{textContent:m(r)},null,8,ie)])}),64))])]))}});var ue=ne(de,[["__scopeId","data-v-6266ada0"]]);const fe={class:"wrapper"},he=y({setup(o){const e=w();if(chrome.storage&&location.href.indexOf("chrome"))chrome.storage.onChanged.addListener(async t=>{const{config:n}=t;n&&await e.dispatch("config/setConfig",v(u({},n),{$_updata:!1}))}),chrome.storage.local.get(["config"],t=>{t.config&&e.dispatch("config/setConfig",v(u({},t.config),{$_updata:!1}))});else{let t=new URL(location.href).searchParams;e.dispatch("config/setConfig",{lave:{title:t.get("laveTitle"),laveTime:t.get("laveTime")},food:{schoolId:t.get("foodSchoolId"),schoolName:t.get("foodSchoolName")},$_updata:!1})}return C(()=>{}),(t,n)=>(h(),_("div",fe,[L(ue),L(se)]))}});U(he).use(Q,b).mount("#app");
